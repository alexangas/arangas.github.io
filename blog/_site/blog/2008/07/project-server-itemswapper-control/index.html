
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Project Server ItemSwapper control</title>
    
    <meta name="author" content="Alex Angas">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Alex Angas</a>
          <ul class="nav">
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h1>Project Server ItemSwapper control </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>28 July 2008</span>
    </div>
    <div class="content">
      <p><em>ItemSwapper hasn&#8217;t been documented by Microsoft so its behaviour may change between service packs - use at your own risk!</em></p>

<p>With the 2007 version, Project Server is now a SharePoint application. One of the best things about this is the nifty stuff you get out of the box as part of SP. Custom controls are a highlight, of which there are many that can be used in your custom Project Server solutions. Even better is that Project Server 2007 comes with some cool controls of its own which you can use in any solution running within Project Server. My latest discovery is the handy <strong>ItemSwapper</strong>.</p>

<p>[caption id=&#8221;attachment_29&#8221; align=&#8221;aligncenter&#8221; width=&#8221;510&#8221; caption=&#8221;ItemSwapper&#8221;]<a href="http://alexangas.files.wordpress.com/2008/07/itemswapper-intro.png"><img src="http://alexangas.files.wordpress.com/2008/07/itemswapper-intro.png" alt="ItemSwapper" /></a>[/caption]</p>

<p>This might look familiar to you from popular administration pages such as &#8220;Manage Queue&#8221; or &#8220;Manage Groups&#8221;. Just by popping one of these on your page, you get a pretty flawless interface to selecting projects. It&#8217;s also speedy and has some great features both client and server side. It&#8217;s great to use in a web part used for selecting report parameters, so that&#8217;s what we&#8217;re going to build in this post!</p>

<p>First of all, let&#8217;s have a look at two other custom controls used by ItemSwapper. There is the ItemSwapperLabel (extended from System.Web.UI.WebControls.Label) which renders the text above each list, and ItemSwapperSelect (extended from System.Web.UI.HtmlControls.HtmlSelect) which renders the list itself. Data binding is done with ItemSwapperSelect and the &#8216;parent&#8217; ItemSwapper control renders all of these controls for you.</p>

<p>The ItemSwapper control refers to the two select lists as the &#8216;alpha&#8217; and &#8216;beta&#8217; lists (originally designed for Greek Project Server?). In our example the beta list will be blank for us to add projects into, so we only want to initalise the alpha list. Looking at the code, our CreateChildControls method contains:
[sourcecode language=&#8217;csharp&#8217;]protected override void CreateChildControls()
{
    alphaSelect = new ItemSwapperSelect();
    alphaSelect.Multiple = true;</p>

<pre><code>projectSwapper = new ItemSwapper();
projectSwapper.ID = "projectSwapper";
projectSwapper.TrackBetaListChanges = true;
projectSwapper.AlphaSelect = alphaSelect;
projectSwapper.LblAlphaList.Text = "Available Projects";
projectSwapper.LblBetaList.Text = "Selected Projects";
projectSwapper.DisplaySelectedItemText = false;
projectSwapper.ShowBetaUpDownButtons = true;
projectSwapper.ShowRestoreAllButton = true;
projectSwapper.ShowRemoveAllButton = true;
this.Controls.Add(projectSwapper); }[/sourcecode]
</code></pre>

<p>This should be pretty self-explanatory (we will discuss the ID and TrackBetaListChanges properties later in this post). Now let&#8217;s perform a data bind in our OnLoad method:
[sourcecode language=&#8217;csharp&#8217;]protected override void OnLoad(EventArgs e)
{
    if (!Page.IsPostBack)
    {
        DataTable projects = DataLayer.GetProjects();
        projectSwapper.DataSource = projects;
        projectSwapper.DataTextField = &#8220;Name&#8221;;
        projectSwapper.DataValueField = &#8220;Uid&#8221;;
    }
}[/sourcecode]</p>

<p>This will now render fine, but the finishing touch is a workaround to what I would call a bug. If you set ShowRestoreAllButton to true, this will display the &#8220;Add All&#8221; button. However it is important to know that this button is greyed out unless the user has selected an item first, meaning that will need two clicks to add all projects to the other list. I don&#8217;t know why Microsoft would have done this, but to get around it, add the following code to our OnPreRender method:
[sourcecode language=&#8217;csharp&#8217;]protected override void OnPreRender(EventArgs e)
{
    alphaSelect.SelectedIndex = 0;
}[/sourcecode]
Have a look at the work so far as the ItemSwapper should now render!</p>

<p>Now let&#8217;s make use of the items chosen in the lists. First of all we&#8217;ll need a button in our web part for users to click on and start the report generation. We&#8217;ll also need at least one hidden field that will contain the selected items for us to use on the server side. Note that there is quite a bit of data we can get from the ItemSwapper JavaScript object, such as a count of items for both lists, text labels of chosen items for both lists, and values (e.g. project GUIDs) of chosen items for both lists!</p>

<p>To be able to do retrieve the data on the client side there are two key properties we need to set when creating the ItemSwapper which I touched upon earlier: ID and TrackBetaListChanges (or if you care about the alpha list, TrackAlphaListChanges). We need to use JavaScript to get a reference to the ItemSwapper object and setting ID lets us use document.getElementByID() to do this. (Surprisingly and fortunately, ID doesn&#8217;t get mangled in usual SharePoint fashion when rendered.) Setting TrackBetaListChanges sets a property on the JavaScript object to, well, track beta list changes.</p>

<p>So going back to CreateChildControls(), let&#8217;s add the following code and connect our server code to the client:
[sourcecode language=&#8217;csharp&#8217;]chosenProjectValues = new HiddenField();
this.Controls.Add(chosenProjectValues);</p>

<p>createButton = new Button();
createButton.Text = &#8220;Create&#8221;;
createButton.Click += CreateButton_Click;  // server-side processing done in this method
createButton.OnClientClick = String.Format(&#8220;SaveItemSwapperValues(&#8216;{0}&#8217;, &#8216;{1}&#8217;);&#8221;, projectSwapper.ID, chosenProjectValues.ClientID);
this.Controls.Add(createButton);[/sourcecode]</p>

<p>Everything&#8217;s ready now on the server side. We just need to create the SaveItemSwapperValues JavaScript function. Put this JavaScript wherever is standard for your projects.
[sourcecode language=&#8217;jscript&#8217;]function SaveItemSwapperValues(itemSwapperClientID, chosenValuesClientID)
{
    var chosenValuesField = document.getElementById(chosenValuesClientID);
    var itemSwapper = document.getElementById(itemSwapperClientID);
    chosenValuesField.value = itemSwapper.GetBetaListValuesAsString();
}[/sourcecode]</p>

<p>That&#8217;s it! Now when your server-code hits CreateButton_Click(), you should find a nice comma-separated list of project GUIDs in the Value property of your hidden field that can be used to generate reports!</p>

<p>But it&#8217;s nice to take things a bit further&#8230; Our Create button is always active, even when no projects are in the chosen list. Well then, behold! The ItemSwapper contains JavaScript event handling functionality! Add script that runs on startup such as this:
[sourcecode language=&#8217;jscript&#8217;]var itemSwapper = document.getElementById(&#8216;projectSwapper&#8217;); // &#8216;projectSwapper&#8217; should be passed as a parameter and not hard-coded
itemSwapper.OnAlphaListChange = ChosenProjectsChanged;
itemSwapper.OnBetaListChange = ChosenProjectsChanged;[/sourcecode]</p>

<p>Then add the following with the SaveItemSwapperValues function:
[sourcecode language=&#8217;jscript&#8217;]function ChosenProjectsChanged()
{
    var itemSwapper = document.getElementById(&#8216;projectSwapper&#8217;);
    var createButton = /* how you get this reference depends on your environment */
    if (itemSwapper.betaListItemCount == 0)
    {
        createButton.disabled = true;
    }
    else
    {
        createButton.disabled = false;
    }
}[/sourcecode]</p>

<p>Now we&#8217;re talkin&#8217; - a smart ItemSwapper. And that&#8217;s not all, there is heaps of handy JavaScript goodness you can hook on to if you&#8217;re able to navigate to this file and have a look: C:\Program Files\Common Files\Microsoft Shared\web server extensions\12\TEMPLATE\LAYOUTS\PWA\LIBRARY\ItemSwapper.htc.</p>

<p>Last but not least, none of the ItemSwapper controls are sealed so you are free to extend them with your own functionality!</p>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#project server-ref">
    		project server <span>8</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#control-ref">control <span>1</span></a></li>
     
    	<li><a href="/tags.html#development-ref">development <span>6</span></a></li>
     
    	<li><a href="/tags.html#Project Server-ref">Project Server <span>8</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/blog/2008/02/intro" title="Intro">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/blog/2008/09/sharepoint-and-sql-schemas" title="SharePoint and SQL schemas">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_shortname = 'arangas'; // required: replace example with your forum shortname
    var disqus_identifier = '24 http://alexangas.github.io/?p=24';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>&copy; 2013 Alex Angas
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-9771527-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>

